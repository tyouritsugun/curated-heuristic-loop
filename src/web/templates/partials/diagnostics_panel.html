<section
  id="diagnostics-panel"
  class="card diagnostics"
  hx-get="/ui/settings/diagnostics"
  hx-trigger="load, settings-changed from:body"
  hx-target="#diagnostics-panel"
  hx-swap="outerHTML"
>
  <header>
    <div>
      <h2>Connectivity &amp; Validation</h2>
      <p class="muted">Checks credential readability, sheet metadata, and model overrides.</p>
    </div>
    <form
      method="post"
      action="/ui/settings/diagnostics"
      hx-post="/ui/settings/diagnostics"
      hx-target="#diagnostics-panel"
      hx-swap="outerHTML"
      hx-indicator="#diagnostics-indicator"
    >
      <button type="submit" class="secondary">Test Connectivity</button>
    </form>
  </header>
  <ul class="diagnostics-list">
    {% for name, status in diagnostics.items() %}
      <li class="diag-row {{ status.state }}">
        <div class="diag-main">
          <span class="status-dot"></span>
          <div>
            <p class="diag-title">{{ status.headline }}</p>
            <p class="diag-detail">{{ status.detail or "" }}</p>
          </div>
        </div>
        <small class="diag-timestamp">{{ status.validated_at or "n/a" }}</small>
      </li>
    {% endfor %}
  </ul>
  <span class="htmx-indicator" id="diagnostics-indicator">Checkingâ€¦</span>
</section>

{% if is_partial and (message or error) %}
  {% with oob=True %}
    {% include "partials/flash.html" %}
  {% endwith %}
{% endif %}
