{% set config_status = env_config_status %}
<section id="config-status-card" class="card">
  <header>
    <div>
      <h2>Configuration Status</h2>
      <p class="muted">Configuration is managed via <code>.env</code> file. Changes take effect immediately without restart.</p>
    </div>
    <span class="status-pill {{ config_status.state }}">{{ config_status.headline }}</span>
  </header>

  <div class="config-status-grid">
    <div class="config-section">
      <h3>Google Credentials</h3>
      {% if config_status.credentials_path %}
        <div class="status-row">
          <span class="status-chip {{ config_status.credentials_state }}">{{ config_status.credentials_status }}</span>
          <code class="config-value">{{ config_status.credentials_path }}</code>
        </div>
        {% if config_status.credentials_detail %}
          <small class="muted">{{ config_status.credentials_detail }}</small>
        {% endif %}
      {% else %}
        <div class="status-row">
          <span class="status-chip error">Not Configured</span>
          <small class="muted">Set GOOGLE_CREDENTIAL_PATH in .env file</small>
        </div>
      {% endif %}
    </div>

    <div class="config-section">
      <h3>Import Spreadsheet</h3>
      {% if config_status.import_sheet_id %}
        <div class="status-row">
          <span class="label">Sheet ID:</span>
          <code class="config-value">{{ config_status.import_sheet_id }}</code>
        </div>
        <div class="status-row">
          <span class="label">Worksheets:</span>
          <span class="config-value">{{ config_status.import_worksheets }}</span>
        </div>
      {% else %}
        <div class="status-row">
          <span class="status-chip error">Not Configured</span>
          <small class="muted">Set IMPORT_SPREADSHEET_ID in .env file</small>
        </div>
      {% endif %}
    </div>

    <div class="config-section">
      <h3>Export Spreadsheet</h3>
      {% if config_status.export_sheet_id %}
        <div class="status-row">
          <span class="label">Sheet ID:</span>
          <code class="config-value">{{ config_status.export_sheet_id }}</code>
        </div>
        <div class="status-row">
          <span class="label">Worksheets:</span>
          <span class="config-value">{{ config_status.export_worksheets }}</span>
        </div>
      {% else %}
        <div class="status-row">
          <span class="status-chip error">Not Configured</span>
          <small class="muted">Set EXPORT_SPREADSHEET_ID in .env file</small>
        </div>
      {% endif %}
    </div>
  </div>

  <details>
    <summary>How to update configuration</summary>
    <ol>
      <li>Edit the <code>.env</code> file in the project root</li>
      <li>Update the relevant environment variables:
        <ul>
          <li><code>GOOGLE_CREDENTIAL_PATH</code> - Path to service account JSON</li>
          <li><code>IMPORT_SPREADSHEET_ID</code> - Published spreadsheet ID</li>
          <li><code>EXPORT_SPREADSHEET_ID</code> - Review spreadsheet ID</li>
        </ul>
      </li>
      <li>Changes take effect on next import/export operation (no restart needed)</li>
    </ol>
    <small class="muted">See <code>.env.sample</code> for complete list of available configuration options.</small>
  </details>

  <details>
    <summary>Test Connection</summary>
    <form
      method="post"
      action="/ui/settings/test-connection"
      hx-post="/ui/settings/test-connection"
      hx-target="#config-status-card"
      hx-swap="outerHTML"
      hx-indicator="#config-test-indicator"
    >
      <button type="submit">Test Connection</button>
      <small class="muted">Validates credentials and lists available worksheets</small>
    </form>
    <span class="htmx-indicator" id="config-test-indicator">Testingâ€¦</span>
  </details>

  {% if is_partial and (message or error) %}
    {% with oob=True %}
      {% include "partials/flash.html" %}
    {% endwith %}
  {% endif %}
</section>
