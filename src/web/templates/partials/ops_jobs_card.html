{% set job_rows = jobs if jobs else (snapshot.jobs if snapshot and snapshot.jobs else []) %}
<section
  id="ops-jobs-card"
  class="card ops-card"
  hx-get="/ui/operations/jobs"
  hx-trigger="load, ops-refresh from:body"
  hx-target="this"
  hx-swap="outerHTML"
  sse-swap="jobs"
>
  <header>
    <div>
      <h2>Job History</h2>
      <p class="muted">Most recent import/export/index jobs.</p>
    </div>
  </header>
  <table class="job-table">
    <thead>
      <tr>
        <th>Job ID</th>
        <th>Type</th>
        <th>Status</th>
        <th>Requested By</th>
        <th>Started</th>
        <th>Finished</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% if job_rows %}
        {% for job in job_rows %}
          {% set status_class = 'job-status-' ~ job.status %}
          <tr>
            <td>{{ job.job_id }}</td>
            <td>{{ job.job_type }}</td>
            <td class="{{ status_class }}">{{ job.status }}</td>
            <td>{{ job.requested_by or 'n/a' }}</td>
            <td>{{ job.started_at or 'pending' }}</td>
            <td>{{ job.finished_at or job.cancelled_at or 'in progress' }}</td>
            <td>
              {% if job.status in ['queued', 'running'] %}
                <form hx-post="/ui/operations/jobs/{{ job.job_id }}/cancel" hx-target="#ops-jobs-card" hx-swap="outerHTML">
                  <button type="submit" class="secondary">Cancel</button>
                </form>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td colspan="7" class="muted">No jobs have been triggered yet.</td>
        </tr>
      {% endif %}
    </tbody>
  </table>
  <span class="htmx-indicator">Refreshing jobsâ€¦</span>
</section>
{% if is_partial and (message or error) %}
  {% with oob=True %}
    {% include "partials/flash.html" %}
  {% endwith %}
{% endif %}
