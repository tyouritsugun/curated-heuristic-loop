<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ title or "Curated Heuristic Loop" }}</title>
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1.5.10/css/pico.min.css" />
  <link rel="stylesheet" href="{{ request.url_for('static', path='css/settings.css') }}" />
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
  <script src="https://unpkg.com/htmx.org/dist/ext/sse.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
</head>
<body hx-boost="true">
  {% include "common/partials/sidebar.html" %}
  <main class="main-content">
    {% block content %}{% endblock %}
  </main>
  <script>
    (function () {
      let mermaidInitialized = false;

      window.renderDocsMermaid = function renderDocsMermaid() {
        if (!window.mermaid || typeof window.mermaid.initialize !== "function") {
          return;
        }

        if (!mermaidInitialized) {
          window.mermaid.initialize({ startOnLoad: false, theme: "default" });
          mermaidInitialized = true;
        }

        const codeBlocks = document.querySelectorAll("pre code.language-mermaid");
        codeBlocks.forEach((codeBlock) => {
          const pre = codeBlock.closest("pre");
          if (!pre) {
            return;
          }

          const wrapper = document.createElement("div");
          wrapper.className = "mermaid";
          wrapper.textContent = codeBlock.textContent.trim();
          pre.replaceWith(wrapper);
        });

        window.mermaid.run({ querySelector: ".doc-content .mermaid" });
      };

      const triggerRender = () => {
        if (typeof window.renderDocsMermaid === "function") {
          window.renderDocsMermaid();
        }
      };

      document.addEventListener("DOMContentLoaded", triggerRender);
      document.body.addEventListener("htmx:afterSwap", triggerRender);
    })();
  </script>
</body>
</html>
